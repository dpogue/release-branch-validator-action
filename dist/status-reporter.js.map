{"version":3,"file":"status-reporter.js","sourceRoot":"","sources":["../src/status-reporter.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,IAAI,MAAM,eAAe,CAAC;AACtC,OAAO,KAAK,MAAM,MAAM,iBAAiB,CAAC;AAC1C,OAAO,KAAK,MAAM,MAAM,UAAU,CAAC;AAInC,MAAM,UAAU,YAAY,CAAC,QAAuB,EAAE,GAAW;IAC/D,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;IACnG,IAAI,CAAC,QAAQ,EAAE;QACb,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC5B,OAAO;KACR;IAED,MAAM,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;IAC9C,IAAI,MAAM,EAAE;QACV,wBAAwB;QACxB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAC7B;SAAM;QACL,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KACzB;IAED,IAAI,GAAG,YAAY,MAAM,CAAC,iBAAiB,EAAE;QAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;YAC/B,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK;YAChC,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;YAC9B,WAAW,EAAE,QAAQ;YACrB,IAAI,EAAE,+DAA+D,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,GAAC,GAAG,GAAC,IAAI,CAAC,EAAE;YAC5G,KAAK,EAAE,SAAS;SACjB,CAAC,CAAC;KACJ;IAED,IAAI,GAAG,YAAY,MAAM,CAAC,iBAAiB,EAAE;QAC3C,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;YAC/B,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK;YAChC,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;YAC9B,WAAW,EAAE,QAAQ;YACrB,IAAI,EAAE,8EAA8E,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,GAAC,EAAE,GAAC,IAAI,CAAC,EAAE;YACxH,KAAK,EAAE,SAAS;SACjB,CAAC,CAAC;KACJ;IAED,IAAI,GAAG,YAAY,MAAM,CAAC,yBAAyB,EAAE;QACnD,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;YAC/B,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK;YAChC,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;YAC9B,WAAW,EAAE,QAAQ;YACrB,IAAI,EAAE,iEAAiE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAC9F,KAAK,EAAE,SAAS;SACjB,CAAC,CAAC;KACJ;IAED,IAAI,GAAG,YAAY,MAAM,CAAC,0BAA0B,EAAE;QACpD,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;YAC/B,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK;YAChC,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI;YAC9B,WAAW,EAAE,QAAQ;YACrB,IAAI,EAAE,+EAA+E,GAAG,CAAC,cAAc,qDAAqD;YAC5J,KAAK,EAAE,SAAS;SACjB,CAAC,CAAC;KACJ;AACH,CAAC","sourcesContent":["import * as core from \"@actions/core\";\nimport * as github from \"@actions/github\";\nimport * as errors from \"./errors\";\n\ntype GHClientType = ReturnType<typeof github.getOctokit>;\n\nexport function reportStatus(ghClient : GHClientType, err : Error) {\n  const prNumber = github.context.payload.pull_request && github.context.payload.pull_request.number;\n  if (!prNumber) {\n    core.setFailed(err.message);\n    return;\n  }\n\n  const strict = core.getBooleanInput('strict');\n  if (strict) {\n    // Fail the status check\n    core.setFailed(err.message);\n  } else {\n    core.error(err.message);\n  }\n\n  if (err instanceof errors.MissingIssueError) {\n    ghClient.rest.pulls.createReview({\n      owner: github.context.repo.owner,\n      repo: github.context.repo.repo,\n      pull_number: prNumber,\n      body: `The following commits are missing Jira issue references:\\n\\n${err.commits.map(sha => '* '+sha+'\\n')}`,\n      event: 'COMMENT'\n    });\n  }\n\n  if (err instanceof errors.MissingLabelError) {\n    ghClient.rest.pulls.createReview({\n      owner: github.context.repo.owner,\n      repo: github.context.repo.repo,\n      pull_number: prNumber,\n      body: `The following Jira issues are missing or have incorrect release labels:\\n\\n${err.issues.map(id => '* '+id+'\\n')}`,\n      event: 'COMMENT'\n    });\n  }\n\n  if (err instanceof errors.InconsistentReleasesError) {\n    ghClient.rest.pulls.createReview({\n      owner: github.context.repo.owner,\n      repo: github.context.repo.repo,\n      pull_number: prNumber,\n      body: `This pull request include Jira issues from multiple releases: ${err.labels.join(', ')}`,\n      event: 'COMMENT'\n    });\n  }\n\n  if (err instanceof errors.IncorrectTargetBranchError) {\n    ghClient.rest.pulls.createReview({\n      owner: github.context.repo.owner,\n      repo: github.context.repo.repo,\n      pull_number: prNumber,\n      body: `According to Jira issue labels, this pull request should be targeting the \\`${err.intendedTarget}\\` branch.\\n\\nPlease double check your base branch!`,\n      event: 'COMMENT'\n    });\n  }\n}\n"]}